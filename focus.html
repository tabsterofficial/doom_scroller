<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus Mode Active - ShameScroll</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="shamescroll-body focus-body">
    <div class="focus-container breathing-animation">
        <h1 class="title-font">ðŸŽ¯ Focus Mode Active</h1>
        
        <div class="mission-text" id="mission-display">
            Loading your mission...
        </div>
        
        <div class="timer-display" id="timer-display">
            25:00
        </div>
        
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        
        <div class="motivational-quote" id="motivational-quote">
            "The way to get started is to quit talking and begin doing." - Walt Disney
        </div>
        
        <div class="blocked-message">
            ðŸš« This site is blocked during your focus session. Stay strong and complete your mission!
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="sessions-today">0</div>
                <div class="stat-label">Sessions Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="current-streak">0</div>
                <div class="stat-label">Day Streak</div>
            </div>
        </div>
    </div>

    <script>
        const motivationalQuotes = [
            "The way to get started is to quit talking and begin doing. - Walt Disney",
            "Success is not final, failure is not fatal: it is the courage to continue that counts. - Winston Churchill",
            "Don't watch the clock; do what it does. Keep going. - Sam Levenson",
            "The future depends on what you do today. - Mahatma Gandhi",
            "You don't have to be great to get started, but you have to get started to be great. - Les Brown",
            "Focus on being productive instead of busy. - Tim Ferriss",
            "The successful warrior is the average man with laser-like focus. - Bruce Lee",
            "Concentrate all your thoughts upon the work at hand. - Alexander Graham Bell"
        ];

        let focusState = null;
        let timerInterval = null;

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
            const secs = (seconds % 60).toString().padStart(2, '0');
            return `${mins}:${secs}`;
        }

        function updateTimer() {
            if (!focusState || !focusState.isActive) return;
            
            const remaining = Math.max(0, Math.floor((focusState.endTime - Date.now()) / 1000));
            const elapsed = Math.max(0, Math.floor((Date.now() - focusState.startTime) / 1000));
            const total = 25 * 60; // 25 minutes in seconds
            
            document.getElementById('timer-display').textContent = formatTime(remaining);
            
            // Update progress bar
            const progress = (elapsed / total) * 100;
            document.getElementById('progress-fill').style.width = `${Math.min(progress, 100)}%`;
            
            if (remaining <= 0) {
                clearInterval(timerInterval);
                document.getElementById('timer-display').textContent = "00:00";
                document.getElementById('motivational-quote').textContent = "ðŸŽ‰ Session complete! Great work!";
            }
        }

        function loadFocusState() {
            if (typeof chrome !== "undefined" && chrome.runtime && chrome.runtime.sendMessage) {
                chrome.runtime.sendMessage({ type: 'GET_FOCUS_STATE' }, (response) => {
                    if (chrome.runtime.lastError) {
                        console.error("Error getting focus state:", chrome.runtime.lastError.message);
                        return;
                    }

                    if (response && response.focusState && response.focusState.isActive) {
                        focusState = response.focusState;
                        document.getElementById('mission-display').textContent = `Mission: ${focusState.mission}`;
                        
                        // Start timer updates
                        updateTimer();
                        timerInterval = setInterval(updateTimer, 1000);
                        
                        // Show random motivational quote
                        const randomQuote = motivationalQuotes[Math.floor(Math.random() * motivationalQuotes.length)];
                        document.getElementById('motivational-quote').textContent = randomQuote;
                    } else {
                        // No active focus session, redirect or show message
                        document.getElementById('mission-display').textContent = "No active focus session";
                        document.getElementById('timer-display').textContent = "00:00";
                    }
                });
            } else {
                console.error("Chrome runtime API is not available. This page must run as part of the extension.");
                document.getElementById('mission-display').textContent = "Error: Extension context not available.";
            }
        }

        function loadStats() {
            if (typeof chrome !== "undefined" && chrome.storage && chrome.storage.local) {
                // Get today's focus sessions
                chrome.storage.local.get(['dailyRecords'], (data) => {
                    if (chrome.runtime.lastError) {
                        console.error("Error getting daily records:", chrome.runtime.lastError.message);
                        return;
                    }
                    const today = new Date().toISOString().split('T')[0];
                    const todayRecord = data.dailyRecords && data.dailyRecords[today];
                    const sessionsToday = todayRecord ? todayRecord.focusSessions : 0;
                    document.getElementById('sessions-today').textContent = sessionsToday;
                });
            }

            if (typeof chrome !== "undefined" && chrome.runtime && chrome.runtime.sendMessage) {
                // Get streak data
                chrome.runtime.sendMessage({ type: 'GET_STREAK_DATA' }, (response) => {
                     if (chrome.runtime.lastError) {
                        console.error("Error getting streak data:", chrome.runtime.lastError.message);
                        return;
                    }
                    if (response && response.streakData) {
                        document.getElementById('current-streak').textContent = response.streakData.current;
                    }
                });
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadFocusState();
            loadStats();
            
            // Update stats periodically
            setInterval(loadStats, 30000);

            // Listen for focus state updates
            if (typeof chrome !== "undefined" && chrome.runtime && chrome.runtime.onMessage) {
                chrome.runtime.onMessage.addListener((message) => {
                    if (message.type === 'FOCUS_STATE_UPDATE') {
                        focusState = message.focusState;
                        if (!focusState.isActive) {
                            clearInterval(timerInterval);
                            // Focus session ended, could redirect to a success page
                            window.location.reload();
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
